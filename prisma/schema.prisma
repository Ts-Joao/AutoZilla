generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id          Int      @id @default(autoincrement())
  email       String   @unique
  name        String?
  password    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  vehicles    Vehicle[]
  profilePic  Photo? @relation("ProfilePic")
}

enum FuelType {
  GASOLINE
  DIESEL
  ELECTRIC
  HYBRID
}

enum VehicleCondition {
  NEW
  USED
  SEMI_NEW
}

enum VehicleColor {
  RED
  BLUE
  GREEN
  BLACK
  WHITE
  SILVER
  YELLOW
  ORANGE
  PURPLE
  BROWN
  GRAY
  GOLD
  PINK
  BEIGE
}

enum TransmissionType {
  MANUAL
  AUTOMATIC
  AUTOMATED
  CVT
  SINGLE_SPEED
}

enum VehicleFeature {
  AIR_CONDITIONING
  POWER_STEERING
  ABS
  SUNROOF
  NAVIGATION_SYSTEM
  BLUETOOTH
  BACKUP_CAMERA
  CRUISE_CONTROL
  HEATED_SEATS
  KEYLESS_ENTRY
}

enum VehicleStatus {
  AVAILABLE
  SOLD
  PENDING
  RESERVED
}

model Vehicle {
  id            String        @id @default(uuid())
  year          Int
  price         Decimal           @db.Decimal(10, 2)
  version       String
  mileage       Int
  sponsored     Boolean           @default(false)
  city          String
  state         String            @db.Char(2)
  plateFinal    String
  categoryId    Int
  fuelType      FuelType
  condition     VehicleCondition
  color         VehicleColor
  transmission  TransmissionType
  status        VehicleStatus     @default(AVAILABLE)
  inspected     Boolean           @default(false)
  armored       Boolean           @default(false)
  ownerId       Int
  createdAt     DateTime          @default(now())
  modelId       Int

  // Relations
  photos    Photo[]
  features  VehicleFeature[]
  model     VehicleModel          @relation(fields: [modelId], references: [id])
  owner     User                  @relation(fields: [ownerId], references: [id])
  category  VehicleCategory       @relation(fields: [categoryId], references: [id])
  
  // Indexes
  @@index([categoryId])
  @@index([price])
  @@index([city, state])
  @@index([condition])
  @@index([inspected])
  @@index([year])
  @@index([mileage])
  @@index([fuelType])
}

model Brand {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  slug      String   @unique

  // Relations
  models    VehicleModel[]
}

model VehicleModel {
  id          Int       @id @default(autoincrement())
  view        Int
  title       String
  brandId     Int

  // Relations
  photo       Photo[]
  vehicle     Vehicle[]
  brand       Brand     @relation(fields: [brandId], references: [id])
}

enum PhotoType {
  VEHICLE
  PROFILE
  CATEGORY
}

model Photo {
  id              String           @id @default(uuid())
  url             String
  type            PhotoType
  vehicleId       String?
  userId          Int?                 @unique
  categoryId      Int?
  vehicleModelId  Int?

  // Ordering of photos
  isMain      Boolean              @default(false)
  order       Int                  @default(0)

  // Relations
  vehicle           Vehicle?              @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  user              User?                 @relation("ProfilePic", fields: [userId], references: [id], onDelete: Cascade)
  vehicleCategory   VehicleCategory?      @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  vehicleModel      VehicleModel?         @relation(fields: [vehicleModelId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([vehicleId])
  @@index([categoryId])
}

model VehicleCategory {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  slug      String   @unique

  // Relations
  vehicles  Vehicle[]
  photos    Photo[]
}